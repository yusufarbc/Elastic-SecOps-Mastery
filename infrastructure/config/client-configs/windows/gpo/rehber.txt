AÅŸaÄŸÄ±daki rehber **Winlogbeat, Metricbeat, Heartbeat, Sysmon gibi tÃ¼m agent'larÄ±n Active Directory â€“ GPO ile otomatik kurulum ve gÃ¼ncellenmesi** iÃ§in tam bir "best practice" dÃ¶kÃ¼mÃ¼dÃ¼r.
Basit, adÄ±m adÄ±m ve tamamen Ã§alÄ±ÅŸÄ±r bir ÅŸekilde hazÄ±rlanmÄ±ÅŸtÄ±r.

---

# ğŸŸ¦ **ğŸ”§ GPO ile Winlogbeat / Metricbeat / Heartbeat / Sysmon DaÄŸÄ±tma Rehberi**

Bu rehber sayesinde tÃ¼m sunucu ve istemcilere merkezi olarak:

* MSI kurulumu
* YML config daÄŸÄ±tÄ±mÄ±
* Servis baÅŸlatma / gÃ¼ncelleme
* Tekrar baÅŸarÄ±sÄ±z olursa otomatik yeniden deneme

GPO Ã¼zerinden gerÃ§ekleÅŸecektir.

---

# 1) ğŸ“ PaylaÅŸÄ±m Dizini HazÄ±rlÄ±ÄŸÄ±

Domain Controller Ã¼zerinde (Ã¶rneÄŸin TTTRADC-S002):

```
C:\elk\
 â”œâ”€â”€ sysmon\
 â”‚    â”œâ”€â”€ Sysmon64.exe
 â”‚    â”œâ”€â”€ sysmon.xml
 â”‚    â””â”€â”€ install-sysmon.bat
 â”œâ”€â”€ winlogbeat\
 â”‚    â”œâ”€â”€ winlogbeat.msi
 â”‚    â”œâ”€â”€ winlogbeat.yml
 â”‚    â””â”€â”€ install-winlogbeat.bat
 â”œâ”€â”€ metricbeat\
 â”‚    â”œâ”€â”€ metricbeat.msi
 â”‚    â”œâ”€â”€ metricbeat.yml
 â”‚    â””â”€â”€ install-metricbeat.bat
 â””â”€â”€ heartbeat\
      â”œâ”€â”€ heartbeat.msi
      â”œâ”€â”€ heartbeat.yml
      â””â”€â”€ install-heartbeat.bat
```

### ğŸ“Œ PaylaÅŸÄ±m izinleri

`C:\elk\`

**Share Permission:**

* Everyone â†’ Read

**NTFS Permission:**

* Authenticated Users â†’ Read & Execute

âš  Agent'lar sadece okuyacak, deÄŸiÅŸiklik yapmayacak.

---

# 2) ğŸ› GPO OluÅŸturma (Startup Script GPO)

Domain Controller'da:

### **1)** Group Policy Management aÃ§

### **2)** OUâ€™yu seÃ§ (Ã¶r. Sunucular OU)

### **3)** SaÄŸ tÄ±k â†’ *Create a GPO in this domain, and Link it hereâ€¦*

Ad verin:

```
ELK-Agent-Deployment
```

### **4)** GPOâ€™ya saÄŸ tÄ±klayÄ±n â†’ **Edit**

---

# 3) âš™ï¸ GPO Ä°Ã§ine Startup Script Ekleme

Policynin altÄ±ndan:

```
Computer Configuration  
   â†’ Policies  
      â†’ Windows Settings  
         â†’ Scripts (Startup/Shutdown)  
            â†’ Startup
```

### â†’ **Startup** Ã§ift tÄ±klayÄ±n

â†’ **Addâ€¦**
â†’ **Browseâ€¦**

Åimdi **GPO'nun kendi script klasÃ¶rÃ¼** aÃ§Ä±lacak:

```
\\DOMAIN\SYSVOL\DOMAIN\Policies\{GPO-GUID}\Machine\Scripts\Startup
```

### ğŸŸ¨ YapmanÄ±z Gereken:

Buraya **install-sysmon.bat**,
**install-winlogbeat.bat**,
**install-metricbeat.bat**,
**install-heartbeat.bat**
dosyalarÄ±nÄ± **kopyalayÄ±n**.

Sonra **Add â†’ Script Name** bÃ¶lÃ¼mÃ¼ne sÄ±rayla ekleyin:

```
install-sysmon.bat
install-winlogbeat.bat
install-metricbeat.bat
install-heartbeat.bat
```

TÃ¼mÃ¼nÃ¼ ekleyebilirsiniz.
GPO her aÃ§Ä±lÄ±ÅŸta sÄ±rayla Ã§alÄ±ÅŸtÄ±rÄ±r.

---

# 4) ğŸ” GPO UygulamasÄ±nÄ± HÄ±zlandÄ±rma

Ä°stemci makinede:

```
gpupdate /force
shutdown /r /t 0
```

Makine aÃ§Ä±ldÄ±ÄŸÄ±nda **GPO Startup Script** devreye girer â†’ servisi kurar / gÃ¼nceller.

---

# 5) ğŸ§ª Log KontrolÃ¼ (Ã§ok Ã¶nemli)

Ä°stemci makinede Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in:

```
Event Viewer â†’ Windows Logs â†’ System
Source: GroupPolicy
```

veya

```
Event Viewer â†’ Applications and Services Logs â†’ Microsoft â†’ Windows â†’ GroupPolicy â†’ Operational
```

Startup script loglarÄ±nÄ± gÃ¶sterir.

---

# 6) âœ” Kurulum SonrasÄ± Kontrol

### Winlogbeat:

```
sc query winlogbeat
type "C:\Program Files\Winlogbeat\logs\winlogbeat"
```

### Metricbeat:

```
sc query metricbeat
type "C:\Program Files\Metricbeat\logs\metricbeat"
```

### Heartbeat:

```
sc query heartbeat
```

### Sysmon:

```
sc query sysmon64
```

---

# 7) ğŸ¯ Ã–nemli Notlar

### âœ” GPO Startup Script **Local SYSTEM** hesabÄ± ile Ã§alÄ±ÅŸÄ±r

Bu yÃ¼zden UNC paylaÅŸÄ±mÄ±na eriÅŸebilmesi iÃ§in:

Åu hesaplarÄ±n OK olmasÄ± gerekir:

* **Domain Computers** â†’ PaylaÅŸÄ±m dizininde `Read`
* Veya Everyone â†’ Read (basit Ã§Ã¶zÃ¼m)

### âœ” Scriptler idempotent

Yani script **10 kez bile Ã§alÄ±ÅŸsa sorun yok**:

* Servis varsa gÃ¼nceller
* Yoksa kurar
* Config'i her zaman kopyalar
* Servisi restart eder

Tam GPOâ€™ya uygun.

---

# 8) ğŸ Bonus: Hata DurumlarÄ±nda Makine Logu Analizi

Startup script Ã§alÄ±ÅŸmÄ±yorsa:

Olay gÃ¼nlÃ¼ÄŸÃ¼nde ÅŸu ID'lere bak:

* **ID 600 â€” Startup script baÅŸlÄ±yor**
* **ID 601 â€” Script baÅŸarÄ±lÄ±**
* **ID 602 â€” Script hata verdi**

---

# HazÄ±r!

Ä°stersen senin ortamÄ±na Ã¶zel GPO raporu veya PowerShell GPO otomasyon scripti de hazÄ±rlayabilirim.

HazÄ±r mÄ±sÄ±n?
