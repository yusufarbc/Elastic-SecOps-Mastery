input {
  # Syslog üzerinden UDP dinlemesi
  udp {
    port => 514  # Syslog'un UDP portu
    codec => plain { charset => "UTF-8" }
  }

  # Syslog üzerinden TCP dinlemesi (opsiyonel)
  tcp {
    port => 514  # Syslog'un TCP portu
    codec => plain { charset => "UTF-8" }
  }
}

filter {
  # Syslog formatındaki logları grok ile parse etme
  grok {
    match => {
      "message" => "%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_host} %{WORD:syslog_program}(\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}"
    }
  }

  # Palo Alto loglarına özgü ek bir parsing işlemi
  if [syslog_program] == "paloalto" {
    # Event ID ve diğer bilgileri ayıklamak
    grok {
      match => {
        "syslog_message" => "%{NUMBER:event_id} %{DATA:subtype} %{DATA:action} %{DATA:src_ip} %{DATA:dst_ip} %{DATA:src_port} %{DATA:dst_port} %{DATA:protocol} %{GREEDYDATA:message}"
      }
    }

    # Özel filtreler ile ek işlem yapılabilir
    mutate {
      add_tag => ["paloalto_parsed"]
    }
  } else {
    drop { }
  }
}

output {
  if "paloalto_parsed" in [tags] {
    elasticsearch {
      hosts    => ["https://localhost:9200"]
      user     => "logstash_ingest"
      password => "GucluBirSifre123!"
      ssl      => true
      cacert   => "/etc/logstash/certs/ca.crt"

      data_stream           => true
      data_stream_type      => "logs"
      data_stream_dataset   => "paloalto"
      data_stream_namespace => "default"
    }
  }
}
